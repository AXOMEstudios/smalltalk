<!DOCTYPE html>
<html>
  <head>
    <title>smalltalk</title>
    <link rel="icon" href="/static/icon.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <link rel="stylesheet" href="/static/styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      /*@import url('https://fonts.googleapis.com/css2?family=Overpass&display=swap');
      body {
        padding: 0;
        margin: 0;
        background-image: url("/static/background.jpeg");
        background-size: 130%;
        background-repeat: no-repeat;
      }
      header {
        margin: 0;
        background-color: #454545;
        display: inline-block;
        width: 95.5%;
        padding: 15px;
        box-shadow: 0 0 30px;
        padding-left: 40px;
      }
      .logo {
        width: 70px;
        height: 70px;
        float: left;
      }
      main {
        background-color: white;
        border-radius: 15px;
        padding: 15px;
        box-shadow: 0 0 30px white;
        text-align: center;
        font-size: 20px;
      }
      .kitbox {
        border: 3px solid dodgerBlue;
        color: dodgerBlue;
        margin: 2%;
        width: 96%;
        opacity: 75;
        padding: 0.5%;
      }
      .heart {
        display: inline-block;
        font-size: 15px;
        float: right;
        text-align: end;
        margin: 5px;
        color: red;
        background: none;
      }
      .img {
        height: 25px;
        width: 25px
        margin: 5px;
      }
      .meta {
        float: left;
        text-align: start;
      }
      .reply {
        display: inline-block;
        font-size: 15px;
        float: right;
        text-align: end;
        margin: 5px;
      }
      
      #spread {
        padding: 1%;
        margin: 2%;
        border: 5px solid blue;
        background-color: dodgerBlue;
        color: white;
        border-radius: 30px;
        text-align: center;
        box-shadow: 0 0 30px dodgerBlue;
      }*/
    </style>
  </head>
  <body>
<nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a class="navbar-item" href="/">
      <img src="/static/icon.png" width="28" height="28">
    </a>
  </div>

  <div id="navbarBasicExample is-active" class="navbar-menu">
    <div class="navbar-start">
    </div>

    <div class="navbar-end">
      <div class="navbar-item">
        <div class="buttons">
          <a class="button is-success" href="/st/new">
            <strong>New Mail</strong>
          </a>
          <a class="button is-danger" href="/logout/">
            Log out
          </a>
        </div>
      </div>
    </div>
  </div>
</nav>

    <h1 id="welcome" style="margin: 2%; font-size: 5vw;"></h1>
    <p style="margin: 2%; font-size: 2vw;">Welcome back to smalltalk! You have {{count}} Mail(s) in your inbox.</p>
    <script>
      var d = new Date();
      var n = d.getHours();
      var w = document.getElementById("welcome");
      
      if (n >= 5 && n <= 11) {
        w.innerHTML = "Wonderful morning!";
      } else if (n >= 11 && n <= 14) {
        w.innerHTML = "Good noon!";
      } else if (n >= 14 && n <= 17) {
        w.innerHTML = "Nice afternoon!";
      } else if (n >= 17 && n <= 22) {
        w.innerHTML = "Great evening!";
      } else if (n >= 22 && n <= 5) {
        w.innerHTML = "Enjoy the night!";
      } else {
        w.innerHTML = "Greetings!";
      }
      
      function closeSpread() {
        document.getElementById("spread").style.display = "none";
      }
    </script>
    <main>
<div class="modal" id="reader">
  <div class="modal-background"></div>
  <div class="modal-card">
    <header class="modal-card-head">
      <p class="modal-card-title">Mail reader</p>
      <button class="delete" aria-label="close" onclick="closeMailView()"></button>
    </header>
    <section class="modal-card-body">
      <iframe style="width: 100%; height: 70vh;" id="mfr" src=""></iframe>
    </section>
    <footer class="modal-card-foot">
      <button class="button is-success" onclick="closeMailView()">Close</button>
      <a id="fs" class="button is-light is-link" target="_blank" href="">Open in new tab</a>
    </footer>
  </div>
</div>
    <script>
function closeMailView() {
  var frame = document.getElementById("mfr");
  frame.style.display = "none";
  fs = document.getElementById("fs");
  fs.style.display = "none";
    var cmb = document.getElementById("reader");
  cmb.style.display = "none";
}

function readMail(i) {
  var cmb = document.getElementById("reader");
  cmb.style.display = "block";
  var frame = document.getElementById("mfr");
  frame.src = "/r/"+i.toString();
  frame.style.display = "block";
  window.scrollTo(0,0);
  fs = document.getElementById("fs");
  fs.href = "/r/"+i.toString();
  fs.style.display = "block";
}

function removeMail(i) {
  if (confirm("Would you really like to remove this mail?")) {
    document.location.href = "/del/"+i.toString();
  }
}
function replyMail(i) {
  document.location.href = "/rep/"+i.toString();
}
    </script>
    <div class="section">
      {% for i in  mails %}
      <div class="columns" id="{{i['id']}}">
        <div class="column is-fullwidth is-vcentered">
          <strong class="subtitle">{{i["sub"]}}</strong>
        </div>
        <div class="column">
          <button onclick="readMail({{i['id']}})" class="button is-primary">READ</button>
          <button onclick="removeMail({{i['id']}})" class="button is-danger">REMOVE</button>
          <button onclick="replyMail({{i['id']}})" class="button is-info">REPLY</button>
        </div>
      </div>
      {% endfor %}
      {% if mails == [] %}
      <h2 color="grey">No new mails!</h2>
      <img src="/static/EmptyBox.png" style="width: 30%; height: 30%">
      {% endif %}
      </div>
    </main>
  </body>
</html>